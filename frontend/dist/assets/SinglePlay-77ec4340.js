import{r as e,j as a,u as _,l as q,y as R,R as J,B as E,C as Q}from"./index-2284c2c6.js";import{C as W,M as ee}from"./CellCpn-9200f594.js";function te({title:l,titleId:i,...o},c){return e.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":i},o),l?e.createElement("title",{id:i},l):null,e.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-2.625 6c-.54 0-.828.419-.936.634a1.96 1.96 0 0 0-.189.866c0 .298.059.605.189.866.108.215.395.634.936.634.54 0 .828-.419.936-.634.13-.26.189-.568.189-.866 0-.298-.059-.605-.189-.866-.108-.215-.395-.634-.936-.634Zm4.314.634c.108-.215.395-.634.936-.634.54 0 .828.419.936.634.13.26.189.568.189.866 0 .298-.059.605-.189.866-.108.215-.395.634-.936.634-.54 0-.828-.419-.936-.634a1.96 1.96 0 0 1-.189-.866c0-.298.059-.605.189-.866Zm-4.34 7.964a.75.75 0 0 1-1.061-1.06 5.236 5.236 0 0 1 3.73-1.538 5.236 5.236 0 0 1 3.695 1.538.75.75 0 1 1-1.061 1.06 3.736 3.736 0 0 0-2.639-1.098 3.736 3.736 0 0 0-2.664 1.098Z",clipRule:"evenodd"}))}const se=e.forwardRef(te),ae=se;function re({title:l,titleId:i,...o},c){return e.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":i},o),l?e.createElement("title",{id:i},l):null,e.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-2.625 6c-.54 0-.828.419-.936.634a1.96 1.96 0 0 0-.189.866c0 .298.059.605.189.866.108.215.395.634.936.634.54 0 .828-.419.936-.634.13-.26.189-.568.189-.866 0-.298-.059-.605-.189-.866-.108-.215-.395-.634-.936-.634Zm4.314.634c.108-.215.395-.634.936-.634.54 0 .828.419.936.634.13.26.189.568.189.866 0 .298-.059.605-.189.866-.108.215-.395.634-.936.634-.54 0-.828-.419-.936-.634a1.96 1.96 0 0 1-.189-.866c0-.298.059-.605.189-.866Zm2.023 6.828a.75.75 0 1 0-1.06-1.06 3.75 3.75 0 0 1-5.304 0 .75.75 0 0 0-1.06 1.06 5.25 5.25 0 0 0 7.424 0Z",clipRule:"evenodd"}))}const le=e.forwardRef(re),A=le;function ne({title:l,titleId:i,...o},c){return e.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":i},o),l?e.createElement("title",{id:i},l):null,e.createElement("path",{fillRule:"evenodd",d:"M3 2.25a.75.75 0 0 1 .75.75v.54l1.838-.46a9.75 9.75 0 0 1 6.725.738l.108.054A8.25 8.25 0 0 0 18 4.524l3.11-.732a.75.75 0 0 1 .917.81 47.784 47.784 0 0 0 .005 10.337.75.75 0 0 1-.574.812l-3.114.733a9.75 9.75 0 0 1-6.594-.77l-.108-.054a8.25 8.25 0 0 0-5.69-.625l-2.202.55V21a.75.75 0 0 1-1.5 0V3A.75.75 0 0 1 3 2.25Z",clipRule:"evenodd"}))}const oe=e.forwardRef(ne),ce=oe,ie=e.forwardRef((l,i)=>{const[o,c]=e.useState("001"),r=e.useRef(1),g=e.useRef(void 0),p=()=>{clearInterval(g.current),g.current=setInterval(()=>{r.current+=1;const C=String(r.current).padStart(3,"0");c(C)},1e3)},S=()=>{clearInterval(g.current)},w=()=>{r.current=0,c("000")};return e.useImperativeHandle(i,()=>({start:p,reset:w,destroy:S})),e.useEffect(()=>()=>{clearInterval(g.current)},[]),a.jsx("span",{children:o})});function L(l,i,o=!0){const c=e.useCallback(r=>{const{key:g,ctrl:p=!1,shift:S=!1,alt:w=!1,preventDefault:C=!0}=l,D=r.key.toLowerCase()===g.toLowerCase(),b=p?r.ctrlKey||r.metaKey:!r.ctrlKey&&!r.metaKey,x=S?r.shiftKey:!r.shiftKey,j=w?r.altKey:!r.altKey;D&&b&&x&&j&&(C&&r.preventDefault(),i())},[l,i]);e.useEffect(()=>{if(o)return window.addEventListener("keydown",c),()=>{window.removeEventListener("keydown",c)}},[c,o])}const de={playing:a.jsx(A,{className:"w-6 h-[100%] text-green-500 p-0 m-0"}),lost:a.jsx(ae,{className:"w-6 h-full text-red-500 p-0 m-0"}),winner:a.jsx(A,{className:"w-6 h-[100%] text-orange-400 p-0 m-0"})};function me(){const[l,i]=e.useState(null),[o,c]=e.useState({revealedCells:new Set,flags:new Set}),[r,g]=e.useState(null),[p,S]=e.useState(""),[w,C]=e.useState({end:!1}),[D,b]=e.useState(!1),[x,j]=e.useState(!1),[s,U]=e.useState(null),[T,G]=e.useState(""),{selectedServer:Z}=_(t=>t.serverOptions),[O,$]=e.useState(!1),k=e.useRef(null);e.useEffect(()=>{const t=q(`${Z}/single`,{transports:["websocket"],upgrade:!1,forceNew:!0,reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,timeout:2e4});return t.connect(),U(t),()=>{t.disconnect()}},[Z]);const z=e.useCallback(t=>{c(n=>{var d,h;const m=new Set(n.revealedCells),u=new Set(n.flags);return(d=t.revealedCells)==null||d.forEach(f=>m.add(f)),(h=t.flags)==null||h.forEach(f=>{u.has(f)?u.delete(f):u.add(f)}),{revealedCells:m,flags:u}})},[]),B=e.useCallback(t=>{var n;O||((n=k.current)==null||n.start(),$(!0)),s&&s.emit("openCell",{index:t})},[s,O]),V=e.useCallback(t=>{s&&s.emit("chording",{index:t})},[s]),P=e.useCallback((t,n)=>{n.preventDefault(),s&&s.emit("toggleFlag",{index:t})},[s]),M=e.useCallback(({message:t})=>{R.error(t)},[]),F=e.useCallback(({gameState:t,revealedCells:n,flags:m,status:u})=>{var d;console.log(t),g(t),G(u),c({revealedCells:new Set(n),flags:new Set(m)}),b(!0),j(!1),(d=k.current)==null||d.reset(),$(!1)},[]),N=e.useCallback(({changes:t,...n})=>{z(t)},[z]),I=e.useCallback(({message:t,revealedCells:n,flags:m,status:u})=>{var d;console.log(t),console.log(u),G(u),c({revealedCells:new Set(n),flags:new Set(m)}),R.success(t),b(!1),j(!0),(d=k.current)==null||d.destroy()},[]);e.useEffect(()=>{if(s)return s.on("error",M),s.on("gameInitialized",F),s.on("stateUpdate",N),s.on("gameOver",I),()=>{s.off("error",M),s.off("gameInitialized",F),s.off("stateUpdate",N),s.off("gameOver",I)}},[s,M,F,N,I]),e.useEffect(()=>{l&&s&&s.emit("initializeGame",l)},[l,s]),L({key:"r",ctrl:!0},()=>{s&&l&&(s.emit("initializeGame",l),R.info("ðŸŽ® Game Ä‘Ã£ Ä‘Æ°á»£c reset!"))},!!(s&&l)),L({key:"?",shift:!0},()=>{R.info(a.jsxs("div",{children:[a.jsx("strong",{children:"PhÃ­m táº¯t:"}),a.jsx("br",{}),"â€¢ Ctrl+R: ChÆ¡i láº¡i",a.jsx("br",{}),"â€¢ Click: Má»Ÿ Ã´",a.jsx("br",{}),"â€¢ Right-click: Äáº·t cá»"]}),{autoClose:5e3})},!0);const H=J.memo(({cell:t,index:n,isRevealed:m,isFlagged:u,canInteract:d,canChording:h,openCell:f,toggleFlag:v})=>{let y="";return u?y=a.jsx(ce,{color:"red"}):m&&(y=t.isMine?"ðŸ’£":t.count>0?t.count:""),a.jsx(W,{canInteract:d,isRevealed:m,count:t.count,onClick:()=>{d?f(n):h&&V(n)},onContextMenu:d?K=>v(n,K):void 0,children:y},n)}),X=e.useCallback(()=>{if(!r||!o)return null;const{ratioX:t,ratioY:n,cells:m}=r,u=o.revealedCells,d=o.flags;return a.jsx("div",{className:"inline-grid gap-[1px] bg-gray-300 p-1 border-2 border-t-white border-l-white border-b-gray-500 border-r-gray-500",style:{gridTemplateColumns:`repeat(${n}, 24px)`,gridTemplateRows:`repeat(${t}, 24px)`},children:m.map((h,f)=>{const v=u.has(f),y=d.has(f),K=!v&&!x,Y=v&&!x;return a.jsx(H,{cell:h,index:f,isRevealed:v,isFlagged:y,canInteract:K,canChording:Y,openCell:B,toggleFlag:P},f)})})},[r,o,x,B,P]);return a.jsxs("div",{className:"p-2 sm:p-4 bg-gray-200 font-sans",children:[a.jsxs("div",{className:"animate-fadeIn",children:[a.jsx(ee,{onModeChange:i}),a.jsxs(E,{className:"inline-block mt-2 w-full sm:w-auto",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs(E,{className:"text-xs sm:text-sm",children:["ðŸš© ",o.flags.size,"/",r==null?void 0:r.totalMines]}),a.jsx(E,{variant:"varButton",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>{s.emit("initializeGame",l)},title:"ChÆ¡i láº¡i",children:de[T]}),a.jsxs(E,{className:"text-xs sm:text-sm",children:["â±ï¸ ",a.jsx(ie,{ref:k})]})]}),r&&a.jsx("div",{className:"mt-4 overflow-x-auto",children:a.jsx("div",{className:"inline-block min-w-min",children:X()})})]})]}),a.jsx(Q,{open:w.end,title:"Káº¿t thÃºc trÃ² chÆ¡i",onClose:()=>C(t=>({...t,end:!1})),children:a.jsx("p",{className:"text-sm text-gray-800 font-sans",children:p})})]})}export{me as default};
